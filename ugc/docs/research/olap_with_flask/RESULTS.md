# Нагрузочное тестирование колоночных баз данных:

* `Clickhouse` (использовались дистрибутивные реплицированные таблицы -> 2 шарда по 2 реплики);
* `Vertica` (использовалась моно таблица).

## Условия испытания:

Для разработанного дизайна данных сервиса UGC (`examples.json`) подготовлена схема данных `schemas.py`. Создано приложение на Flask, поддерживающее минимально необходимый функционал:

`http://kafka.olegtsss.ru:5003/delete/` удалять все записи из базы данных `Clickhouse`;
`http://kafka.olegtsss.ru:5003/create/` создавать одну запись в базе `Clickhouse` в соответствии с разработанной схемой данных;
`http://kafka.olegtsss.ru:5003/bulk/{count}/` создавать `count` записей в базе `Clickhouse` в соответствии с разработанной схемой данных;
`http://kafka.olegtsss.ru:5003/read/` читать все записи из базы `Clickhouse`;
`http://kafka.olegtsss.ru:5005/delete/` удалять все записи из базы данных `Vertica`;
`http://kafka.olegtsss.ru:5005/create/` создавать одну запись в базе `Vertica` в соответствии с разработанной схемой данных;
`http://kafka.olegtsss.ru:5005/read/` читать все записи из базы `Vertica`.

Приложение запускалось через сервер приложений `gunicorn` и веб сервер `nginx` в докер контейнерах. Нагрузка генерировалась посредством `Locust`: 
1) 1000 клиентов в течении 10 минут непрерывно наполняли хранилище - `clickhouse_write_1.png`, `clickhouse_write_2.png`, `vertica_write_1.png`, `vertica_write_2.png`;
2) 2 клиента в течении 10 минут непрерывно считывали все записи базы данных, подготовленные на шаге ранее - `clickhouse_read_1.png`, `clickhouse_read_2.png`, `vertica_read_1.png`, `vertica_read_2.png`;
3) 1000 клиентов в течении 1 минуты непрерывно наполняли хранилище по 1, 10, 50, 100 и 250 строк за раз - `clickhouse_bulk_1.png`, `clickhouse_bulk_10.png`, `vertica_bulk_50.png`, `vertica_bulk_100.png`, `vertica_bulk_250.png`.

## Результаты:

Полученные результаты свидетельствуют, что `Vertica` работает на запись и чтение в 2 раза быстрее `Clickhouse`, что связано с технической сложностью и ресурсоемкостью шардирования и реплицирования данных. В связи с тем, что сервис UGC не нуждается в надежном и пуленепробиваемом хранилище данных, я бы предложил использовать для него `Vertica`. Однако есть важное замечание: документация у последнего не самая удобная в использовании, в отличии от отечественного `Clickhouse`. Дополнительно проведеные испытания `Clickhouse` bulk запросами показали, что оптимально использовать загрузку пачками по 100 штук.
